<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bài Thi Thử IOE Lớp 4 (ĐỀ SỐ 3.1)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .word-block {
            user-select: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans antialiased text-gray-800">
    <div id="root"></div>

    <script type="text/babel">
        // All React components and data are bundled into this single script tag.
        
        // --- DỮ LIỆU CÂU HỎI IOE LỚP 4 (ĐỀ SỐ 3.1 - 100 CÂU) ---
        const questions = [
            {
                type: 'fill-in-the-blank',
                question: '____ do you like Maths? - Because I like to learn about numbers.',
                correctAnswer: 'Why',
                correctAnswer_vi: 'Tại sao',
                hint_vi: 'Câu trả lời có "Because" (bởi vì), nên câu hỏi phải hỏi về lý do. (3 ký tự)',
                rationale_vi: 'Khi câu trả lời bắt đầu bằng "Because" (bởi vì), câu hỏi phải dùng "Why" (Tại sao) để hỏi lý do.',
                rationale_en: 'The answer starts with "Because", so the question must use "Why" to ask for a reason.'
            },
            {
                type: 'fill-in-the-blank',
                question: 'Good ____ ning, Miss Nga.',
                correctAnswer: 'mor',
                correctAnswer_vi: 'mor (để hoàn thành "morning")',
                hint_vi: 'Từ dùng để chào buổi sáng. (3 ký tự)',
                rationale_vi: 'Cụm từ chào buổi sáng là "Good morning".',
                rationale_en: 'The correct phrase for a morning greeting is "Good morning".'
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Jane.', 'for', 'I have', 'present', 'a birthday'],
                correctAnswer: 'I have a birthday present for Jane.',
                correctAnswer_vi: 'Tôi có một món quà sinh nhật cho Jane.',
                hint_vi: 'Bắt đầu câu với chủ ngữ "I". Cấu trúc: S + V + O.',
                rationale_vi: 'Cấu trúc câu khẳng định: Subject (I) + Verb (have) + Object (a birthday present) + for + Person (Jane).',
                rationale_en: 'Statement structure: Subject + Verb + Object + Prepositional Phrase.'
            },
            {
                type: 'mc',
                question: '___ Mai and Lan your friends?',
                options: [ { text: 'A. Do', isCorrect: false }, { text: 'B. Does', isCorrect: false }, { text: 'C. Is', isCorrect: false }, { text: 'D. Are', isCorrect: true } ],
                correctAnswer: 'D. Are',
                correctAnswer_vi: 'Are (to be số nhiều)',
                hint_vi: 'Chủ ngữ "Mai and Lan" là số nhiều, cần động từ to be ở dạng số nhiều.',
                rationale_vi: 'Chủ ngữ "Mai and Lan" (hai người) là số nhiều, nên phải dùng động từ to be là "Are".',
                rationale_en: 'The plural subject "Mai and Lan" requires the plural verb "Are".'
            },
            {
                type: 'multimedia',
                question: 'I ... English very well.',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/21/635206405636920678_Audio.mp3',
                audioContent: 'I speak English very well.',
                options: [ { text: 'A. speak', isCorrect: true }, { text: 'B. meet', isCorrect: false }, { text: 'C. teach', isCorrect: false }, { text: 'D. listen', isCorrect: false } ],
                correctAnswer: 'A. speak',
                correctAnswer_vi: 'nói (speak English)',
                hint_vi: 'Nghe động từ đi kèm với "English".',
                rationale_vi: 'Nội dung nghe được là "I speak English very well" (Tôi nói tiếng Anh rất tốt).',
                rationale_en: 'The audio content is "I speak English very well".'
            },
            {
                type: 'mc',
                question: 'There are … days in January.',
                options: [ { text: 'A. thirty-one', isCorrect: true }, { text: 'B. thirty-first', isCorrect: false }, { text: 'C. thirtieth', isCorrect: false }, { text: 'D. thirty', isCorrect: false } ],
                correctAnswer: 'A. thirty-one',
                correctAnswer_vi: 'ba mươi mốt',
                hint_vi: 'Tháng Một (January) có bao nhiêu ngày? Cần dùng số đếm.',
                rationale_vi: 'Tháng Một có 31 ngày. "Thirty-one" là số đếm, trong khi "thirty-first" là số thứ tự.',
                rationale_en: 'January has 31 days. "Thirty-one" is the cardinal number needed here, not the ordinal number.'
            },
            {
                type: 'fill-in-the-blank',
                question: 'My si____er has a fish.',
                correctAnswer: 'st',
                correctAnswer_vi: 'st (để hoàn thành "sister")',
                hint_vi: 'Từ chỉ chị/em gái. (2 ký tự)',
                rationale_vi: 'Từ cần điền là "sister" (chị/em gái).',
                rationale_en: 'The missing letters form the word "sister".'
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['your friend?', 'did you', 'time', 'see', 'What'],
                correctAnswer: 'What time did you see your friend?',
                correctAnswer_vi: 'Bạn đã gặp bạn của mình lúc mấy giờ?',
                hint_vi: 'Câu hỏi Wh-question ở thì quá khứ đơn (What time did...?).',
                rationale_vi: 'Cấu trúc câu hỏi thì quá khứ đơn: What time + did + Subject + Verb (nguyên mẫu) + ...?',
                rationale_en: 'Past Simple question structure: What time + did + Subject + Base Verb + ...?'
            },
            {
                type: 'fill-in-the-blank',
                question: 'This is my friend, Michelle. She c____s from America.',
                correctAnswer: 'ome',
                correctAnswer_vi: 'ome (để hoàn thành "comes")',
                hint_vi: 'Động từ "đến từ" (come) chia ở ngôi thứ ba số ít.',
                rationale_vi: 'Động từ "come" phải được chia ở ngôi thứ ba số ít (She) thành "comes".',
                rationale_en: 'The verb "come" must be conjugated as "comes" for the third-person singular subject "She".'
            },
            {
                type: 'mc',
                question: 'Are they students? – Yes, ... .',
                options: [ { text: 'A. they are', isCorrect: true }, { text: 'B. they do', isCorrect: false }, { text: 'C. are they', isCorrect: false }, { text: 'D. are their', isCorrect: false } ],
                correctAnswer: 'A. they are',
                correctAnswer_vi: 'đúng vậy',
                hint_vi: 'Câu hỏi bắt đầu bằng "Are they", câu trả lời khẳng định là "Yes, they are".',
                rationale_vi: 'Câu hỏi Yes/No với "Are they...?" được trả lời khẳng định là "Yes, they are".',
                rationale_en: 'The correct affirmative response to "Are they...?" is "Yes, they are".'
            },
            {
                type: 'mc',
                question: 'Lisa is 10 years old. Minh is … friend.',
                options: [ { text: 'A. she', isCorrect: false }, { text: 'B. she is', isCorrect: false }, { text: 'C. his', isCorrect: false }, { text: 'D. her', isCorrect: true } ],
                correctAnswer: 'D. her',
                correctAnswer_vi: 'của cô ấy',
                hint_vi: 'Cần một tính từ sở hữu cho "Lisa" (nữ).',
                rationale_vi: 'Vì Lisa là nữ, chúng ta dùng tính từ sở hữu "her" (của cô ấy).',
                rationale_en: 'Since Lisa is female, the correct possessive adjective is "her".'
            },
            {
                type: 'fill-in-the-blank',
                question: 'Ha can dance b____ cannot play football.',
                correctAnswer: 'ut',
                correctAnswer_vi: 'ut (để hoàn thành "but")',
                hint_vi: 'Từ nối hai ý trái ngược nhau (có thể... nhưng không thể). (2 ký tự)',
                rationale_vi: 'Liên từ "but" (nhưng) dùng để nối hai mệnh đề đối lập.',
                rationale_en: 'The conjunction "but" connects two contrasting ideas.'
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['in', 'What are', 'doing', 'the students', 'the classroom?'],
                correctAnswer: 'What are the students doing in the classroom?',
                correctAnswer_vi: 'Các bạn học sinh đang làm gì trong lớp học?',
                hint_vi: 'Câu hỏi Wh-question ở thì hiện tại tiếp diễn (What are... doing?).',
                rationale_vi: 'Cấu trúc: What + are + Subject + doing + Place?',
                rationale_en: 'Present Continuous question structure: What + are + Subject + doing + Place?'
            },
            {
                type: 'mc',
                question: 'It’s not difficult ... a new dress.',
                options: [ { text: 'A. make', isCorrect: false }, { text: 'B. makes', isCorrect: false }, { text: 'C. to make', isCorrect: true }, { text: 'D. making', isCorrect: false } ],
                correctAnswer: 'C. to make',
                correctAnswer_vi: 'để làm (to-infinitive)',
                hint_vi: 'Cấu trúc "It\'s + adjective + to do something".',
                rationale_vi: 'Sau cấu trúc "It is + adjective", chúng ta dùng "to-infinitive" (động từ nguyên mẫu có "to") để chỉ mục đích hoặc hành động.',
                rationale_en: 'The structure "It is + adjective" is followed by a to-infinitive.'
            },
            {
                type: 'fill-in-the-blank',
                question: 'Would you l____e some milk?',
                correctAnswer: 'ik',
                correctAnswer_vi: 'ik (để hoàn thành "like")',
                hint_vi: 'Từ dùng trong lời mời lịch sự "Would you like...?". (2 ký tự)',
                rationale_vi: 'Cụm từ mời lịch sự là "Would you like..." (Bạn có muốn...).',
                rationale_en: 'The polite invitation structure uses the verb "like".'
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['can', 'sister', 'My', 'speak', 'French.'],
                correctAnswer: 'My sister can speak French.',
                correctAnswer_vi: 'Chị/em gái tôi có thể nói tiếng Pháp.',
                hint_vi: 'Sử dụng động từ khuyết thiếu "can" (có thể).',
                rationale_vi: 'Cấu trúc với "can": Chủ ngữ + can + V-nguyên mẫu + ...',
                rationale_en: 'Structure with "can": Subject + can + base verb + ...'
            },
            {
                type: 'mc',
                question: 'I have Maths ___ Mondays to Wednesdays.',
                options: [ { text: 'A. from', isCorrect: true }, { text: 'B. to', isCorrect: false }, { text: 'C. at', isCorrect: false }, { text: 'D. on', isCorrect: false } ],
                correctAnswer: 'A. from',
                correctAnswer_vi: 'từ (from... to...)',
                hint_vi: 'Cấu trúc chỉ khoảng thời gian "từ... đến...".',
                rationale_vi: 'Cấu trúc "from... to..." được dùng để chỉ một khoảng thời gian từ điểm bắt đầu đến điểm kết thúc.',
                rationale_en: 'The structure "from... to..." is used to indicate a period of time.'
            },
            {
                type: 'mc',
                question: 'Happy birthday, Mary. This cake is for ....',
                options: [ { text: 'A. I', isCorrect: false }, { text: 'B. you', isCorrect: true }, { text: 'C. he', isCorrect: false }, { text: 'D. she', isCorrect: false } ],
                correctAnswer: 'B. you',
                correctAnswer_vi: 'bạn',
                hint_vi: 'Sau giới từ "for", cần một đại từ tân ngữ.',
                rationale_vi: 'Sau giới từ (for), chúng ta cần dùng đại từ tân ngữ (object pronoun). Đại từ tân ngữ của "Mary" (ngôi thứ hai) là "you".',
                rationale_en: 'After a preposition like "for", an object pronoun is needed. The correct pronoun is "you".'
            },
            {
                type: 'fill-in-the-blank',
                question: 'Wh____ are the maps? – They are on the wall.',
                correctAnswer: 'ere',
                correctAnswer_vi: 'ere (để hoàn thành "Where")',
                hint_vi: 'Câu trả lời là nơi chốn ("on the wall"), dùng từ hỏi "Where". (3 ký tự)',
                rationale_vi: 'Câu trả lời chỉ nơi chốn, từ hỏi phải là "Where" (Ở đâu).',
                rationale_en: 'The question word for location is "Where".'
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['birthday', 'Her', 'in', 'June.', 'is'],
                correctAnswer: 'Her birthday is in June.',
                correctAnswer_vi: 'Sinh nhật của cô ấy vào tháng Sáu.',
                hint_vi: 'Chủ ngữ "Her birthday" đứng đầu câu. Giới từ "in" đi với tháng.',
                rationale_vi: 'Cấu trúc câu: Subject (Her birthday) + Verb (is) + Prepositional Phrase (in June).',
                rationale_en: 'Sentence structure: Subject + Verb + Prepositional Phrase.'
            },
            {
                type: 'fill-in-the-blank',
                question: '“Tom and Jerry” is my favouri____ cartoon.',
                correctAnswer: 'te',
                correctAnswer_vi: 'te (để hoàn thành "favourite")',
                hint_vi: 'Từ có nghĩa là "yêu thích". (2 ký tự)',
                rationale_vi: 'Từ cần điền là "favourite" (yêu thích).',
                rationale_en: 'The missing letters form the word "favourite".'
            },
            {
                type: 'mc',
                question: 'How … is he? – He is ten years old.',
                options: [ { text: 'A. young', isCorrect: false }, { text: 'B. time', isCorrect: false }, { text: 'C. old', isCorrect: true }, { text: 'D. food', isCorrect: false } ],
                correctAnswer: 'C. old',
                correctAnswer_vi: 'tuổi (How old?)',
                hint_vi: 'Câu hỏi về tuổi tác.',
                rationale_vi: 'Cấu trúc hỏi tuổi là "How old is...?".',
                rationale_en: 'The question structure for age is "How old is...?".'
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['you. I’m', 'meet', 'It’s', 'from Hanoi.', 'nice to'],
                correctAnswer: 'It’s nice to meet you. I’m from Hanoi.',
                correctAnswer_vi: 'Rất vui được gặp bạn. Tôi đến từ Hà Nội.',
                hint_vi: 'Đây là hai câu, một câu chào và một câu giới thiệu.',
                rationale_vi: 'Câu chào hỏi thông dụng "It\'s nice to meet you" và câu giới thiệu "I\'m from Hanoi".',
                rationale_en: 'A common greeting followed by an introduction.'
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['close friends. We', 'We are', 'are from', 'Nguyen Du Primary School.'],
                correctAnswer: 'We are close friends. We are from Nguyen Du Primary School.',
                correctAnswer_vi: 'Chúng tôi là bạn thân. Chúng tôi đến từ Trường Tiểu học Nguyễn Du.',
                hint_vi: 'Đây là hai câu riêng biệt giới thiệu mối quan hệ và nơi học.',
                rationale_vi: 'Câu đầu tiên giới thiệu "We are close friends". Câu thứ hai giới thiệu "We are from...".',
                rationale_en: 'Two separate sentences, one introducing the relationship and the other the origin.'
            },
            {
                type: 'fill-in-the-blank',
                question: '____ do Steve and his brother do? – They are soccer players.',
                correctAnswer: 'What',
                correctAnswer_vi: 'Cái gì',
                hint_vi: 'Câu hỏi về nghề nghiệp hoặc công việc. (4 ký tự)',
                rationale_vi: 'Để hỏi về nghề nghiệp, ta dùng cấu trúc "What do/does + S + do?".',
                rationale_en: 'To ask about a profession, the structure "What do/does + S + do?" is used.'
            },
            {
                type: 'fill-in-the-blank',
                question: 'Does she like playing vo____eyball?',
                correctAnswer: 'll',
                correctAnswer_vi: 'll (để hoàn thành "volleyball")',
                hint_vi: 'Tên một môn thể thao đồng đội. (2 ký tự)',
                rationale_vi: 'Từ cần điền là "volleyball" (bóng chuyền).',
                rationale_en: 'The missing letters form the word "volleyball".'
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['swimming? Yes,', 'Nam like', 'Does', 'he does.'],
                correctAnswer: 'Does Nam like swimming? Yes, he does.',
                correctAnswer_vi: 'Nam có thích bơi không? Vâng, có.',
                hint_vi: 'Câu hỏi Yes/No thì hiện tại đơn và câu trả lời ngắn.',
                rationale_vi: 'Cấu trúc câu hỏi: Does + Subject + like + V-ing? Câu trả lời ngắn: Yes, + subject pronoun + does.',
                rationale_en: 'Question structure: Does + Subject + like + Gerund? Short answer: Yes, + pronoun + does.'
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Where does', 'games and', 'English songs?', 'learn', 'Mary'],
                correctAnswer: 'Where does Mary learn games and English songs?',
                correctAnswer_vi: 'Mary học trò chơi và các bài hát tiếng Anh ở đâu?',
                hint_vi: 'Câu hỏi Wh-question (Where) ở thì hiện tại đơn.',
                rationale_vi: 'Cấu trúc câu hỏi: Where + does + Subject + Verb (nguyên mẫu) + Object?',
                rationale_en: 'Simple Present Wh-question structure: Where + does + Subject + Base Verb + Object?'
            },
            {
                type: 'mc',
                question: 'What’s ... name? – He’s Tommy.',
                options: [ { text: 'A. her', isCorrect: false }, { text: 'B. his', isCorrect: true }, { text: 'C. she', isCorrect: false }, { text: 'D. he', isCorrect: false } ],
                correctAnswer: 'B. his',
                correctAnswer_vi: 'của anh ấy',
                hint_vi: 'Câu trả lời là "He’s Tommy" (tên con trai), cần tính từ sở hữu cho nam.',
                rationale_vi: 'Vì người được nhắc đến là nam ("He\'s Tommy"), chúng ta dùng tính từ sở hữu "his".',
                rationale_en: 'The person is male ("He\'s Tommy"), so the possessive adjective "his" is used.'
            },
            {
                type: 'multimedia',
                question: 'L____',
                mediaType: 'image',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop4/Captruong/anh/D4_10.jpg',
                imagePrompt: 'Picture of a lion.',
                correctAnswer: 'ion',
                correctAnswer_vi: 'ion (để hoàn thành "Lion")',
                hint_vi: 'Tên con vật là chúa tể rừng xanh. (4 ký tự)',
                rationale_vi: 'Hình ảnh cho thấy một con sư tử.',
                rationale_en: 'The image depicts a lion.'
            },
            {
                type: 'mc',
                question: 'I ... my teeth in the morning.',
                options: [ { text: 'A. do', isCorrect: false }, { text: 'B. brush', isCorrect: true }, { text: 'C. have', isCorrect: false }, { text: 'D. does', isCorrect: false } ],
                correctAnswer: 'B. brush',
                correctAnswer_vi: 'đánh (brush my teeth)',
                hint_vi: 'Động từ nào đi với "teeth" để chỉ việc vệ sinh răng?',
                rationale_vi: 'Cụm từ đúng là "brush my teeth" (đánh răng).',
                rationale_en: 'The correct collocation is "brush my teeth".'
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Are', 'crayons?', 'those', 'new', 'your'],
                correctAnswer: 'Are those your new crayons?',
                correctAnswer_vi: 'Kia có phải là những chiếc bút sáp màu mới của bạn không?',
                hint_vi: 'Câu hỏi Yes/No với "Are those...". Tính từ "new" đứng trước danh từ "crayons".',
                rationale_vi: 'Cấu trúc: Are + those + your + adjective + noun?',
                rationale_en: 'Question structure: Are + those + your + adjective + noun?'
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Why', 'English?', 'like', 'does', 'Mai'],
                correctAnswer: 'Why does Mai like English?',
                correctAnswer_vi: 'Tại sao Mai thích tiếng Anh?',
                hint_vi: 'Câu hỏi Wh-question (Why) ở thì hiện tại đơn.',
                rationale_vi: 'Cấu trúc câu hỏi: Why + does + Subject + Verb (nguyên mẫu) + Object?',
                rationale_en: 'Simple Present Wh-question structure: Why + does + Subject + Base Verb + Object?'
            },
            {
                type: 'mc',
                question: 'I have Vietnamese, Maths, Art and ____.',
                options: [ { text: 'A. England', isCorrect: false }, { text: 'B. class', isCorrect: false }, { text: 'C. music room', isCorrect: false }, { text: 'D. Science', isCorrect: true } ],
                correctAnswer: 'D. Science',
                correctAnswer_vi: 'Khoa học (Science)',
                hint_vi: 'Cần một tên môn học khác để điền vào danh sách.',
                rationale_vi: 'Trong các lựa chọn, chỉ có "Science" (Khoa học) là tên một môn học.',
                rationale_en: 'Among the options, only "Science" is a school subject.'
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['I’m', 'Green Leaf', 'Primary School.', 'a student', 'at'],
                correctAnswer: 'I’m a student at Green Leaf Primary School.',
                correctAnswer_vi: 'Tôi là một học sinh tại Trường Tiểu học Green Leaf.',
                hint_vi: 'Câu giới thiệu bản thân. "at" đi với tên trường.',
                rationale_vi: 'Cấu trúc: I\'m + a student + at + School Name.',
                rationale_en: 'Structure: I\'m + a student + at + School Name.'
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Australian.', 'is', 'This', 'Jenny. She’s'],
                correctAnswer: 'This is Jenny. She’s Australian.',
                correctAnswer_vi: 'Đây là Jenny. Cô ấy là người Úc.',
                hint_vi: 'Hai câu, một câu giới thiệu và một câu nói về quốc tịch.',
                rationale_vi: 'Câu giới thiệu: "This is Jenny". Câu về quốc tịch: "She\'s Australian".',
                rationale_en: 'An introductory sentence followed by a sentence about nationality.'
            },
            {
                type: 'fill-in-the-blank',
                question: 'This is my do____l.',
                correctAnswer: 'l',
                correctAnswer_vi: 'l (để hoàn thành "doll")',
                hint_vi: 'Tên một loại đồ chơi. (1 ký tự)',
                rationale_vi: 'Từ cần điền là "doll" (búp bê).',
                rationale_en: 'The missing letter completes the word "doll".'
            },
            {
                type: 'fill-in-the-blank',
                question: 'My mother ____ a teacher.',
                correctAnswer: 'is',
                correctAnswer_vi: 'là (to be số ít)',
                hint_vi: 'Động từ to be chia với chủ ngữ số ít "My mother". (2 ký tự)',
                rationale_vi: 'Chủ ngữ số ít "My mother" dùng động từ to be "is".',
                rationale_en: 'The singular subject "My mother" takes "is".'
            },
            {
                type: 'multimedia',
                question: 'I can play the ... .',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/21/635206443150071000_Audio.mp3',
                audioContent: 'I can play the piano.',
                options: [ { text: 'A. guitar', isCorrect: false }, { text: 'B. drums', isCorrect: false }, { text: 'C. piano', isCorrect: true }, { text: 'D. plane', isCorrect: false } ],
                correctAnswer: 'C. piano',
                correctAnswer_vi: 'đàn piano',
                hint_vi: 'Nghe tên nhạc cụ được nhắc đến.',
                rationale_vi: 'Nội dung nghe được là "I can play the piano" (Tôi có thể chơi piano).',
                rationale_en: 'The audio content is "I can play the piano".'
            },
            {
                type: 'multimedia',
                question: 'I ____ MUSIC.',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop4/Captruong/nghe/D3_8.mp3',
                audioContent: 'I LIKE MUSIC.',
                correctAnswer: 'LIKE',
                correctAnswer_vi: 'thích',
                hint_vi: 'Động từ chỉ sở thích. (4 ký tự)',
                rationale_vi: 'Nội dung nghe được: "I like music" (Tôi thích âm nhạc).',
                rationale_en: 'The audio says "I like music".'
            },
            {
                type: 'fill-in-the-blank',
                question: 'What is your fav____te subject?',
                correctAnswer: 'ouri',
                correctAnswer_vi: 'ouri (để hoàn thành "favourite")',
                hint_vi: 'Từ có nghĩa là "yêu thích". (4 ký tự)',
                rationale_vi: 'Từ cần điền là "favourite" (yêu thích).',
                rationale_en: 'The missing letters form the word "favourite".'
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['going, Nam?', 'are', 'Where', 'you'],
                correctAnswer: 'Where are you going, Nam?',
                correctAnswer_vi: 'Bạn đang đi đâu vậy Nam?',
                hint_vi: 'Câu hỏi Wh-question ở thì hiện tại tiếp diễn.',
                rationale_vi: 'Cấu trúc: Where + are + Subject + going?',
                rationale_en: 'Present Continuous question structure: Where + are + Subject + going?'
            },
            {
                type: 'fill-in-the-blank',
                question: 'What subjects d____ you have today?',
                correctAnswer: 'o',
                correctAnswer_vi: 'o (để hoàn thành "do")',
                hint_vi: 'Cần trợ động từ cho câu hỏi ở thì hiện tại đơn. (1 ký tự)',
                rationale_vi: 'Trợ động từ "do" được dùng với chủ ngữ "you" trong câu hỏi hiện tại đơn.',
                rationale_en: 'The auxiliary verb "do" is used with the subject "you" in simple present questions.'
            },
            {
                type: 'fill-in-the-blank',
                question: 'Please have a look ____ my new bike. It’s very nice.',
                correctAnswer: 'at',
                correctAnswer_vi: 'vào (look at)',
                hint_vi: 'Cụm từ "look at" có nghĩa là "nhìn vào". (2 ký tự)',
                rationale_vi: 'Cụm động từ cố định là "look at" (nhìn vào).',
                rationale_en: 'The fixed phrase is "look at".'
            },
            {
                type: 'multimedia',
                question: 'HE GOES SWIMMING ON ____ .',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop4/Captruong/nghe/D4_5.mp3',
                audioContent: 'HE GOES SWIMMING ON SATURDAY.',
                correctAnswer: 'saturday',
                correctAnswer_vi: 'Thứ bảy',
                hint_vi: 'Nghe tên một ngày trong tuần. (9 ký tự)',
                rationale_vi: 'Nội dung nghe được là "on Saturday" (vào Thứ Tư).',
                rationale_en: 'The audio specifies the day as "Saturday".'
            },
            {
                type: 'fill-in-the-blank',
                question: 'What ____ do you go to school? - I go to school at seven o’clock.',
                correctAnswer: 'time',
                correctAnswer_vi: 'giờ',
                hint_vi: 'Câu trả lời là giờ cụ thể, cần từ để hỏi về thời gian. (4 ký tự)',
                rationale_vi: 'Để hỏi về giờ chính xác, ta dùng "What time...".',
                rationale_en: 'To ask for a specific time, use "What time...".'
            },
            {
                type: 'fill-in-the-blank',
                question: 'W____ did you meet? - Some famous musicians.',
                correctAnswer: 'ho',
                correctAnswer_vi: 'ho (để hoàn thành "Who")',
                hint_vi: 'Câu trả lời là người ("musicians"), cần từ để hỏi về người. (2 ký tự)',
                rationale_vi: 'Câu trả lời nhắc đến người ("musicians") nên từ hỏi phải là "Who" (Ai).',
                rationale_en: 'The answer refers to people, so the question word should be "Who".'
            },
            {
                type: 'fill-in-the-blank',
                question: 'Daisy is ____ m England. She can speak English.',
                correctAnswer: 'fro',
                correctAnswer_vi: 'fro (để hoàn thành "from")',
                hint_vi: 'Giới từ chỉ nguồn gốc, xuất xứ. (3 ký tự)',
                rationale_vi: 'Giới từ "from" (đến từ) dùng để chỉ nơi xuất xứ.',
                rationale_en: 'The preposition "from" is used to indicate origin.'
            },
            {
                type: 'multimedia',
                question: 'What lessons have they got today?',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/1/3/636505757866893157_Audio.mp3',
                audioContent: 'Today, we\'ve got Maths, English and Science.',
                options: [ { text: 'A. Maths, Science and Music.', isCorrect: false }, { text: 'B. Science, Music and IT.', isCorrect: false }, { text: 'C. English, Maths and Vietnamese.', isCorrect: false }, { text: 'D. Maths, English and Science.', isCorrect: true } ],
                correctAnswer: 'D. Maths, English and Science.',
                correctAnswer_vi: 'Toán, Tiếng Anh và Khoa học',
                hint_vi: 'Nghe kỹ tên ba môn học được liệt kê.',
                rationale_vi: 'Nội dung nghe được là "Maths, English and Science".',
                rationale_en: 'The audio clearly states the subjects are "Maths, English and Science".'
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['meet', 'the movie theatre.', 'in front', 'Let\'s', 'of'],
                correctAnswer: 'Let\'s meet in front of the movie theatre.',
                correctAnswer_vi: 'Chúng ta hãy gặp nhau trước rạp chiếu phim.',
                hint_vi: 'Câu đề nghị bắt đầu bằng "Let\'s". Cụm giới từ "in front of".',
                rationale_vi: 'Cấu trúc đề nghị: Let\'s + Verb + Place.',
                rationale_en: 'Suggestion structure: Let\'s + Verb + Place.'
            },
            {
                type: 'fill-in-the-blank',
                question: 'It’s ____ hot here. We need a fan.',
                correctAnswer: 'very',
                correctAnswer_vi: 'rất',
                hint_vi: 'Trạng từ chỉ mức độ, đứng trước tính từ. (4 ký tự)',
                rationale_vi: 'Trạng từ "very" (rất) được dùng để nhấn mạnh tính từ "hot".',
                rationale_en: 'The adverb "very" is used to intensify the adjective "hot".'
            },
            {
                type: 'mc',
                question: 'I’m from France. ... you?',
                options: [ { text: 'A. Too', isCorrect: false }, { text: 'B. This', isCorrect: false }, { text: 'C. That', isCorrect: false }, { text: 'D. And', isCorrect: true } ],
                correctAnswer: 'D. And',
                correctAnswer_vi: 'Và (And you?)',
                hint_vi: 'Cách ngắn gọn để hỏi lại "Còn bạn thì sao?".',
                rationale_vi: '"And you?" là một cách nói ngắn gọn và thông dụng để hỏi lại người khác, tương tự "How about you?".',
                rationale_en: '"And you?" is a common and concise way to ask the same question back to someone.'
            },
            {
                type: 'fill-in-the-blank',
                question: 'W____ was your mother yesterday? – She was at home.',
                correctAnswer: 'here',
                correctAnswer_vi: 'here (để hoàn thành "Where")',
                hint_vi: 'Câu trả lời là nơi chốn ("at home"), cần từ để hỏi về địa điểm. (4 ký tự)',
                rationale_vi: 'Câu trả lời chỉ nơi chốn, từ hỏi phải là "Where" (Ở đâu).',
                rationale_en: 'The question word for location is "Where".'
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['is', 'orange.', 'an', 'That'],
                correctAnswer: 'That is an orange.',
                correctAnswer_vi: 'Kia là một quả cam.',
                hint_vi: 'Mạo từ "an" đi trước "orange" (bắt đầu bằng nguyên âm).',
                rationale_vi: 'Cấu trúc: That + is + an + Noun (starting with a vowel).',
                rationale_en: 'Structure: That + is + an + Noun (starting with a vowel).'
            },
            {
                type: 'multimedia',
                question: 'Look at the duckl____ng. It’s very cute.',
                mediaType: 'image',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop4/Captruong/anh/D3_4.jpg',
                imagePrompt: 'Picture of a small, yellow duckling.',
                correctAnswer: 'i',
                correctAnswer_vi: 'i (để hoàn thành "duckling")',
                hint_vi: 'Từ có nghĩa là "vịt con". (1 ký tự)',
                rationale_vi: 'Từ cần điền là "duckling" (vịt con).',
                rationale_en: 'The missing letter completes the word "duckling".'
            },
            {
                type: 'mc',
                question: 'What is your favourite ...? – I like pink.',
                options: [ { text: 'A. food', isCorrect: false }, { text: 'B. drink', isCorrect: false }, { text: 'C. subject', isCorrect: false }, { text: 'D. colour', isCorrect: true } ],
                correctAnswer: 'D. colour',
                correctAnswer_vi: 'màu sắc',
                hint_vi: 'Câu trả lời là "pink" (màu hồng).',
                rationale_vi: 'Pink (màu hồng) là một màu sắc (colour).',
                rationale_en: 'Pink is a colour.'
            },
            {
                type: 'mc',
                question: 'Can you swim? - ... .',
                options: [ { text: 'A. No, I can', isCorrect: false }, { text: 'B. No, thanks', isCorrect: false }, { text: 'C. Yes, I can’t', isCorrect: false }, { text: 'D. Yes, I can', isCorrect: true } ],
                correctAnswer: 'D. Yes, I can',
                correctAnswer_vi: 'Vâng, tôi có thể.',
                hint_vi: 'Câu trả lời khẳng định cho câu hỏi bắt đầu bằng "Can".',
                rationale_vi: 'Câu trả lời phải tương ứng với từ được hỏi ("Can"). "Yes, I can" là câu trả lời khẳng định đúng.',
                rationale_en: 'A question starting with "Can" must be answered using "can" or "can\'t". This is the correct affirmative response.'
            },
            {
                type: 'fill-in-the-blank',
                question: 'What is Mai doing in t____ classroom?',
                correctAnswer: 'he',
                correctAnswer_vi: 'he (để hoàn thành "the")',
                hint_vi: 'Cần mạo từ xác định "the". (2 ký tự)',
                rationale_vi: 'Cần mạo từ xác định "the" trước danh từ "classroom".',
                rationale_en: 'The definite article "the" is needed before "classroom".'
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['goes to', 'Saturdays.', 'My brother', 'the tennis club', 'on'],
                correctAnswer: 'My brother goes to the tennis club on Saturdays.',
                correctAnswer_vi: 'Anh trai tôi đến câu lạc bộ quần vợt vào các ngày thứ Bảy.',
                hint_vi: 'Cấu trúc thì hiện tại đơn. Giới từ "on" đi với ngày.',
                rationale_vi: 'Subject (My brother) + Verb (goes to) + Place (the tennis club) + Time (on Saturdays).',
                rationale_en: 'Simple Present tense structure: Subject + Verb + Place + Time.'
            },
            {
                type: 'mc',
                question: 'How old ... she? – 10.',
                options: [ { text: 'A. is', isCorrect: true }, { text: 'B. be', isCorrect: false }, { text: 'C. are', isCorrect: false }, { text: 'D. does', isCorrect: false } ],
                correctAnswer: 'A. is',
                correctAnswer_vi: 'là (to be số ít)',
                hint_vi: 'Chủ ngữ "she" đi với động từ to be "is".',
                rationale_vi: 'Chủ ngữ ngôi thứ ba số ít "she" dùng động từ to be là "is".',
                rationale_en: 'The third-person singular subject "she" takes the verb "is".'
            },
            {
                type: 'mc',
                question: 'I learn … numbers during Maths lessons.',
                options: [ { text: 'A. to', isCorrect: false }, { text: 'B. about', isCorrect: true }, { text: 'C. at', isCorrect: false }, { text: 'D. on', isCorrect: false } ],
                correctAnswer: 'B. about',
                correctAnswer_vi: 'về (learn about)',
                hint_vi: 'Cụm từ "học về" một chủ đề gì đó.',
                rationale_vi: 'Cụm động từ cố định là "learn about" (học về).',
                rationale_en: 'The correct phrasal verb is "learn about".'
            },
            {
                type: 'multimedia',
                question: 'Today’s ____.',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/11/29/636790904736652955_Audio.mp3',
                audioContent: 'Today\'s Monday.',
                correctAnswer: 'Monday',
                correctAnswer_vi: 'Thứ Hai',
                hint_vi: 'Nghe tên một ngày trong tuần. (6 ký tự)',
                rationale_vi: 'Nội dung nghe được: "Today\'s Monday" (Hôm nay là Thứ Hai).',
                rationale_en: 'The audio content is "Today\'s Monday".'
            },
            {
                type: 'fill-in-the-blank',
                question: 'W____ class is Phong in? – He’s in class 4F.',
                correctAnswer: 'hat',
                correctAnswer_vi: 'hat (để hoàn thành "What")',
                hint_vi: 'Từ để hỏi về lớp học. (3 ký tự)',
                rationale_vi: 'Cấu trúc hỏi lớp là "What class is... in?".',
                rationale_en: 'The structure to ask for a class is "What class is... in?".'
            },
            {
                type: 'mc',
                question: 'That is ... chair.',
                options: [ { text: 'A. am', isCorrect: false }, { text: 'B. is', isCorrect: false }, { text: 'C. are', isCorrect: false }, { text: 'D. her', isCorrect: true } ],
                correctAnswer: 'D. her',
                correctAnswer_vi: 'của cô ấy',
                hint_vi: 'Cần một tính từ sở hữu đứng trước danh từ "chair".',
                rationale_vi: 'Trong các lựa chọn, chỉ có "her" là tính từ sở hữu có thể đứng trước danh từ "chair".',
                rationale_en: 'Only "her" is a possessive adjective that can precede the noun "chair".'
            },
            {
                type: 'mc',
                question: 'What’s _______ name?',
                options: [ { text: 'A. it', isCorrect: false }, { text: 'B. your cat', isCorrect: false }, { text: 'C. your cat’s', isCorrect: true }, { text: 'D. cat’s', isCorrect: false } ],
                correctAnswer: 'C. your cat’s',
                correctAnswer_vi: 'tên con mèo của bạn',
                hint_vi: 'Cần một cụm danh từ sở hữu cách (possessive noun phrase).',
                rationale_vi: 'Cấu trúc đúng để hỏi tên của một vật/con vật thuộc sở hữu của ai đó là "What\'s + [possessive phrase] + name?".',
                rationale_en: 'The correct structure uses a possessive phrase: "your cat\'s name".'
            },
            {
                type: 'multimedia',
                question: 'We spent a few days at the re____ last summer.',
                mediaType: 'image',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2016/12/1/636162019754752262_566X320.jpg',
                imagePrompt: 'Picture of a seaside resort.',
                correctAnswer: 'sort',
                correctAnswer_vi: 'sort (để hoàn thành "resort")',
                hint_vi: 'Nơi nghỉ dưỡng, thường ở gần biển. (4 ký tự)',
                rationale_vi: 'Hình ảnh mô tả một khu nghỉ dưỡng (resort).',
                rationale_en: 'The image depicts a resort.'
            },
            {
                type: 'fill-in-the-blank',
                question: 'Today is Sunday. L____t’s go to the cinema.',
                correctAnswer: 'e',
                correctAnswer_vi: 'e (để hoàn thành "Let\'s")',
                hint_vi: 'Cấu trúc đề nghị, rủ rê. (1 ký tự)',
                rationale_vi: 'Cấu trúc "Let\'s" (Let us) dùng để đưa ra lời đề nghị.',
                rationale_en: 'The phrase "Let\'s" is used to make a suggestion.'
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Can', 'climb', 'your', 'sister', 'a tree?'],
                correctAnswer: 'Can your sister climb a tree?',
                correctAnswer_vi: 'Chị/em gái của bạn có thể trèo cây không?',
                hint_vi: 'Câu hỏi Yes/No với "Can".',
                rationale_vi: 'Cấu trúc câu hỏi năng lực: Can + Subject + Verb + Object?',
                rationale_en: 'Ability question structure: Can + Subject + Verb + Object?'
            },
            {
                type: 'mc',
                question: 'Thank you very much. – You’re ... .',
                options: [ { text: 'A. well', isCorrect: false }, { text: 'B. stay', isCorrect: false }, { text: 'C. welcome', isCorrect: true }, { text: 'D. come', isCorrect: false } ],
                correctAnswer: 'C. welcome',
                correctAnswer_vi: 'không có gì (You\'re welcome)',
                hint_vi: 'Câu đáp lại lời cảm ơn.',
                rationale_vi: 'Cụm từ "You\'re welcome" là cách đáp lại lịch sự cho lời cảm ơn.',
                rationale_en: '"You\'re welcome" is the standard polite response to "Thank you".'
            },
            {
                type: 'multimedia',
                question: 'STUDY ____',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop4/Captruong/nghe/D4_1.mp3',
                audioContent: 'STUDY ENGLISH',
                correctAnswer: 'ENGLISH',
                correctAnswer_vi: 'Tiếng Anh',
                hint_vi: 'Nghe tên một môn học. (7 ký tự)',
                rationale_vi: 'Nội dung nghe được là "Study English" (Học Tiếng Anh).',
                rationale_en: 'The audio says "Study English".'
            },
            {
                type: 'multimedia',
                question: 'Nick can s____ but he can’t swim.',
                mediaType: 'image',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/11/26/636788548987333045_566X320.jpg',
                imagePrompt: 'Picture of someone skating.',
                correctAnswer: 'kate',
                correctAnswer_vi: 'kate (để hoàn thành "skate")',
                hint_vi: 'Động từ chỉ hành động phát ra âm nhạc bằng giọng nói. (4 ký tự)',
                rationale_vi: 'Hình ảnh mô tả hành động trượt pa tin.',
                rationale_en: 'The image depicts someone skating.'
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['jumping', 'very', 'likes', 'He', 'high.'],
                correctAnswer: 'He likes jumping very high.',
                correctAnswer_vi: 'Anh ấy thích nhảy rất cao.',
                hint_vi: 'Cấu trúc: S + likes + V-ing + Adverbial Phrase.',
                rationale_vi: 'Cấu trúc: Subject (He) + likes + Gerund (jumping) + Adverbial Phrase (very high).',
                rationale_en: 'Structure: Subject + likes + Gerund + Adverbial Phrase.'
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['your sister', 'does', 'What', 'look', 'like?'],
                correctAnswer: 'What does your sister look like?',
                correctAnswer_vi: 'Chị/em gái bạn trông như thế nào?',
                hint_vi: 'Câu hỏi về ngoại hình (What... look like?).',
                rationale_vi: 'Cấu trúc hỏi về ngoại hình: What + does + Subject + look like?',
                rationale_en: 'Question structure for appearance: What + does + Subject + look like?'
            },
            {
                type: 'mc',
                question: '“I have a long tail. I live in the tree. I love bananas.” WHO AM I?',
                options: [ { text: 'A. I’m an elephant.', isCorrect: false }, { text: 'B. I’m a monkey.', isCorrect: true }, { text: 'C. I’m a snake.', isCorrect: false }, { text: 'D. I’m a giraffe.', isCorrect: false } ],
                correctAnswer: 'B. I’m a monkey.',
                correctAnswer_vi: 'Tôi là một con khỉ.',
                hint_vi: 'Con vật nào sống trên cây và thích ăn chuối?',
                rationale_vi: 'Dựa trên các mô tả (đuôi dài, sống trên cây, thích chuối), con vật đó là con khỉ (monkey).',
                rationale_en: 'Based on the descriptions (long tail, lives in trees, loves bananas), the animal is a monkey.'
            },
            {
                type: 'multimedia',
                question: 'Tom’s from ____.',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/11/29/636790679070814804_Audio.mp3',
                audioContent: 'Tom\'s from America.',
                correctAnswer: 'America',
                correctAnswer_vi: 'Châu Mỹ/Nước Mỹ',
                hint_vi: 'Tên một quốc gia. (7 ký tự)',
                rationale_vi: 'Nội dung nghe được: "Tom\'s from America".',
                rationale_en: 'The audio confirms Tom\'s origin is "America".'
            },
            {
                type: 'fill-in-the-blank',
                question: 'This is my m____ther.',
                correctAnswer: 'o',
                correctAnswer_vi: 'o (để hoàn thành "mother")',
                hint_vi: 'Từ chỉ "mẹ". (1 ký tự)',
                rationale_vi: 'Từ cần điền là "mother" (mẹ).',
                rationale_en: 'The missing letter completes the word "mother".'
            },
            {
                type: 'mc',
                question: '... do you like Music? – Because I like to sing.',
                options: [ { text: 'A. How', isCorrect: false }, { text: 'B. When', isCorrect: false }, { text: 'C. Why', isCorrect: true }, { text: 'D. Who', isCorrect: false } ],
                correctAnswer: 'C. Why',
                correctAnswer_vi: 'Tại sao',
                hint_vi: 'Câu trả lời dùng "Because", cần từ để hỏi về lý do.',
                rationale_vi: 'Khi câu trả lời bắt đầu bằng "Because" (bởi vì), câu hỏi phải dùng "Why" (Tại sao) để hỏi lý do.',
                rationale_en: 'The answer starts with "Because", so the question must use "Why" to ask for a reason.'
            },
            {
                type: 'multimedia',
                question: 'Sorry, I’m ____.',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2019/11/28/637105327139009573_Audio.mp3',
                audioContent: 'Sorry, I’m late.',
                options: [ { text: 'A. wrong', isCorrect: false }, { text: 'B. late', isCorrect: true }, { text: 'C. false', isCorrect: false }, { text: 'D. not well.', isCorrect: false } ],
                correctAnswer: 'B. late',
                correctAnswer_vi: 'trễ/muộn',
                hint_vi: 'Nghe từ đi sau "Sorry, I\'m...".',
                rationale_vi: 'Nội dung nghe được là "Sorry, I\'m late" (Xin lỗi, tôi đến muộn).',
                rationale_en: 'The audio content is "Sorry, I\'m late".'
            },
            {
                type: 'mc',
                question: 'Jane can ... a horse.',
                options: [ { text: 'A. ride', isCorrect: true }, { text: 'B. play', isCorrect: false }, { text: 'C. stay', isCorrect: false }, { text: 'D. drink', isCorrect: false } ],
                correctAnswer: 'A. ride',
                correctAnswer_vi: 'cưỡi (ride a horse)',
                hint_vi: 'Động từ nào đi với "a horse"?',
                rationale_vi: 'Cụm từ đúng là "ride a horse" (cưỡi ngựa).',
                rationale_en: 'The correct collocation is "ride a horse".'
            },
            {
                type: 'mc',
                question: 'Choose the word that has underlined part pronounced differently from the others.',
                options: [ { text: 'A. B**oo**k', isCorrect: false }, { text: 'B. G**oo**d', isCorrect: false }, { text: 'C. Aftern**oo**n', isCorrect: true }, { text: 'D. F**oo**tball', isCorrect: false } ],
                correctAnswer: 'C. Afternoon',
                correctAnswer_vi: 'Afternoon (âm /uː/ dài)',
                hint_vi: 'Tìm từ có âm "oo" phát âm khác với các từ còn lại.',
                rationale_vi: '"oo" trong "Afternoon" được phát âm là /uː/ (âm u dài), trong khi ở các từ còn lại là /ʊ/ (âm u ngắn).',
                rationale_en: 'The "oo" in "Afternoon" is a long /uː/ sound, while the others have a short /ʊ/ sound.'
            },
            {
                type: 'mc',
                question: '... are they? – They’re dogs.',
                options: [ { text: 'A. Who', isCorrect: false }, { text: 'B. What', isCorrect: true }, { text: 'C. Which', isCorrect: false }, { text: 'D. Where', isCorrect: false } ],
                correctAnswer: 'B. What',
                correctAnswer_vi: 'Cái gì/Con gì',
                hint_vi: 'Câu hỏi về loài vật (dogs).',
                rationale_vi: 'Khi hỏi về vật hoặc loài vật, chúng ta dùng "What". "Who" chỉ dùng cho người.',
                rationale_en: '"What" is used to ask about things or animals. "Who" is for people.'
            },
            {
                type: 'fill-in-the-blank',
                question: 'The building is very ta____l.',
                correctAnswer: 'l',
                correctAnswer_vi: 'l (để hoàn thành "tall")',
                hint_vi: 'Từ có nghĩa là "cao". (1 ký tự)',
                rationale_vi: 'Từ cần điền là "tall" (cao).',
                rationale_en: 'The missing letter completes the word "tall".'
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['John', 'likes to', 'play', 'games', 'very much.'],
                correctAnswer: 'John likes to play games very much.',
                correctAnswer_vi: 'John rất thích chơi game.',
                hint_vi: 'Cấu trúc: S + likes + to V + O + very much.',
                rationale_vi: 'Cấu trúc: Subject (John) + likes + to play games + very much.',
                rationale_en: 'Structure: Subject + likes + to-infinitive + Object + Adverbial Phrase.'
            },
            {
                type: 'fill-in-the-blank',
                question: 'I’m 7 years o____.',
                correctAnswer: 'ld',
                correctAnswer_vi: 'ld (để hoàn thành "old")',
                hint_vi: 'Cụm từ chỉ tuổi "years old". (2 ký tự)',
                rationale_vi: 'Cụm từ hoàn chỉnh để nói tuổi là "years old".',
                rationale_en: 'The complete phrase for age is "years old".'
            },
            {
                type: 'mc',
                question: 'That is my ... . His name is Minh.',
                options: [ { text: 'A. ten', isCorrect: false }, { text: 'B. pen', isCorrect: false }, { text: 'C. friend', isCorrect: true }, { text: 'D. and', isCorrect: false } ],
                correctAnswer: 'C. friend',
                correctAnswer_vi: 'bạn',
                hint_vi: 'Câu sau nói "His name is Minh" (tên con trai), cần danh từ chỉ người.',
                rationale_vi: 'Chỉ có "friend" (bạn) là danh từ chỉ người phù hợp với ngữ cảnh.',
                rationale_en: 'Only "friend" is a noun referring to a person that fits the context.'
            },
            {
                type: 'multimedia',
                question: 'I have three new ____.',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/21/635206450576162044_Audio.mp3',
                audioContent: 'I have three new books.',
                correctAnswer: 'books',
                correctAnswer_vi: 'những cái diều',
                hint_vi: 'Nghe tên đồ vật ở dạng số nhiều. (5 ký tự)',
                rationale_vi: 'Nội dung nghe được là "I have three new books" (Tôi có ba cái quyển sách mới).',
                rationale_en: 'The audio content is "I have three new books".'
            },
            {
                type: 'mc',
                question: 'Let’s ... a picture of a cat.',
                options: [ { text: 'A. draw', isCorrect: true }, { text: 'B. draws', isCorrect: false }, { text: 'C. to draw', isCorrect: false }, { text: 'D. drawing', isCorrect: false } ],
                correctAnswer: 'A. draw',
                correctAnswer_vi: 'vẽ (động từ nguyên mẫu)',
                hint_vi: 'Sau "Let\'s" là động từ nguyên mẫu (V-base).',
                rationale_vi: 'Cấu trúc "Let\'s" luôn đi với động từ nguyên mẫu không "to".',
                rationale_en: 'The structure "Let\'s" is always followed by a base verb.'
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['likes', 'very much.', 'games', 'Tom', 'to play'],
                correctAnswer: 'Tom likes to play games very much.',
                correctAnswer_vi: 'Tom rất thích chơi game.',
                hint_vi: 'Cấu trúc: S + likes + to V + O + very much.',
                rationale_vi: 'Cấu trúc: Subject (Tom) + likes + to play games + very much.',
                rationale_en: 'Structure: Subject + likes + to-infinitive + Object + Adverbial Phrase.'
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Maths', 'on', 'I have', 'lessons', 'Thursday.'],
                correctAnswer: 'I have Maths lessons on Thursday.',
                correctAnswer_vi: 'Tôi có tiết Toán vào Thứ Năm.',
                hint_vi: 'Giới từ "on" đi với ngày trong tuần.',
                rationale_vi: 'Cấu trúc: Subject (I) + Verb (have) + Object (Maths lessons) + Time (on Thursday).',
                rationale_en: 'Structure: Subject + Verb + Object + Time.'
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['is', 'This', 'my cousin. He', 'is from', 'Nam Dinh.'],
                correctAnswer: 'This is my cousin. He is from Nam Dinh.',
                correctAnswer_vi: 'Đây là anh họ của tôi. Anh ấy đến từ Nam Định.',
                hint_vi: 'Hai câu riêng biệt, một câu giới thiệu và một câu nói về quê quán.',
                rationale_vi: 'Câu đầu: "This is my cousin". Câu sau: "He is from Nam Dinh".',
                rationale_en: 'Two separate sentences for introduction and origin.'
            },
            {
                type: 'fill-in-the-blank',
                question: 'Happy bi____day to you, Nam.',
                correctAnswer: 'rth',
                correctAnswer_vi: 'rth (để hoàn thành "birthday")',
                hint_vi: 'Từ này có nghĩa là "sinh nhật". (3 ký tự)',
                rationale_vi: 'Từ cần điền là "birthday" (sinh nhật).',
                rationale_en: 'The missing letters complete the word "birthday".'
            },
            {
                type: 'mc',
                question: 'Choose the odd one out:',
                options: [ { text: 'A. skip', isCorrect: false }, { text: 'B. ski', isCorrect: false }, { text: 'C. climb', isCorrect: false }, { text: 'D. puzzle', isCorrect: true } ],
                correctAnswer: 'D. puzzle',
                correctAnswer_vi: 'trò chơi xếp hình (là danh từ)',
                hint_vi: 'Ba từ là động từ chỉ hành động, một từ là danh từ chỉ đồ chơi.',
                rationale_vi: 'Skip, ski, climb là động từ. Puzzle là danh từ.',
                rationale_en: 'Skip, ski, and climb are verbs, while "puzzle" is a noun.'
            },
            {
                type: 'multimedia',
                question: 'The girl can’t play on Monday because she has a M____ lesson.',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/1/3/636505724660583338_Audio.mp3',
                audioContent: 'I can’t play on Monday because I have a Music lesson.',
                correctAnswer: 'USIC',
                correctAnswer_vi: 'USIC (để hoàn thành "MUSIC")',
                hint_vi: 'Nghe tên một môn học. (4 ký tự)',
                rationale_vi: 'Nội dung nghe được là "...a Music lesson" (một tiết Âm nhạc).',
                rationale_en: 'The audio mentions a "Music lesson".'
            },
            {
                type: 'fill-in-the-blank',
                question: 'Give me a pen, please. - H____ you are.',
                correctAnswer: 'ere',
                correctAnswer_vi: 'ere (để hoàn thành "Here")',
                hint_vi: 'Cụm từ cố định "Here you are" (Của bạn đây). (3 ký tự)',
                rationale_vi: 'Cụm từ cố định là "Here you are" (Của bạn đây).',
                rationale_en: 'The fixed phrase is "Here you are".'
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['to school', 'go', 'by bike.', 'I', 'usually'],
                correctAnswer: 'I usually go to school by bike.',
                correctAnswer_vi: 'Tôi thường đi học bằng xe đạp.',
                hint_vi: 'Trạng từ chỉ tần suất (usually) đứng trước động từ thường (go).',
                rationale_vi: 'Cấu trúc: Subject + Adverb of Frequency + Verb + ...',
                rationale_en: 'Structure: Subject + Adverb of Frequency + Verb + ...'
            },
            {
                type: 'fill-in-the-blank',
                question: 'Your bedroom is big. How about the bathroom? Is it big t____?',
                correctAnswer: 'oo',
                correctAnswer_vi: 'oo (để hoàn thành "too")',
                hint_vi: 'Từ có nghĩa là "cũng vậy". (2 ký tự)',
                rationale_vi: 'Từ "too" (cũng vậy) được dùng ở cuối câu khẳng định.',
                rationale_en: 'The word "too" (also) is used at the end of an affirmative sentence.'
            },
            {
                type: 'mc',
                question: 'John learns to sing ... Music lessons.',
                options: [ { text: 'A. from', isCorrect: false }, { text: 'B. to', isCorrect: false }, { text: 'C. during', isCorrect: true }, { text: 'D. under', isCorrect: false } ],
                correctAnswer: 'C. during',
                correctAnswer_vi: 'trong suốt',
                hint_vi: 'Giới từ chỉ khoảng thời gian xảy ra hành động.',
                rationale_vi: '"During" (trong suốt) dùng để chỉ hành động xảy ra trong khoảng thời gian của buổi học.',
                rationale_en: '"During" is used to indicate an action happening within the time frame of the lessons.'
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['on Sundays.', 'He', 'doesn\'t', 'to school', 'go'],
                correctAnswer: 'He doesn\'t go to school on Sundays.',
                correctAnswer_vi: 'Anh ấy không đi học vào các ngày Chủ nhật.',
                hint_vi: 'Cấu trúc phủ định thì hiện tại đơn: S + doesn\'t + V-nguyên mẫu + ...',
                rationale_vi: 'Chủ ngữ "He" dùng trợ động từ phủ định "doesn\'t".',
                rationale_en: 'Negative Simple Present tense: He doesn\'t go to school...'
            },
            {
                type: 'mc',
                question: 'What pet does Kai have?',
                options: [ { text: 'A. He have a goldfish.', isCorrect: false }, { text: 'B. He has a yo-yo.', isCorrect: false }, { text: 'C. He has a puppy.', isCorrect: true }, { text: 'D. He has a new pencil case.', isCorrect: false } ],
                correctAnswer: 'C. He has a puppy.',
                correctAnswer_vi: 'Cậu ấy có một chú cún con.',
                hint_vi: 'Câu hỏi về "pet" (thú cưng). Chỉ có một lựa chọn là thú cưng.',
                rationale_vi: 'Câu hỏi là "What pet...?" (Thú cưng gì...?). Chỉ có "puppy" (cún con) là thú cưng. "He has" là đúng ngữ pháp.',
                rationale_en: 'The question is about a pet. Only "puppy" is a pet. "He has" is grammatically correct.'
            },
            {
                type: 'fill-in-the-blank',
                question: 'A: ____ does Mary like Maths? - B: Because she wants to learn about numbers.',
                correctAnswer: 'Why',
                correctAnswer_vi: 'Tại sao',
                hint_vi: 'Câu trả lời có "Because", cần từ để hỏi về lý do. (3 ký tự)',
                rationale_vi: 'Khi câu trả lời bắt đầu bằng "Because" (bởi vì), câu hỏi phải dùng "Why" (Tại sao) để hỏi lý do.',
                rationale_en: 'The answer starts with "Because", so the question must use "Why" to ask for a reason.'
            }
        ];

        // --- Component: MediaDisplay (Helper for Image/Audio rendering) ---
        const MediaDisplay = ({ question, showMessage }) => {
            if (question.mediaType === 'image') {
                return (
                    <div className="w-full p-4 bg-gray-100 rounded-xl mb-4 text-center border-2 border-dashed border-gray-300">
                        <p className="text-blue-600 font-bold mb-2">🖼️ Câu hỏi kèm Hình ảnh</p>
                        <img 
                            src={question.mediaSource}
                            alt={question.imagePrompt || 'Media for the question'} 
                            className="w-full max-w-xs mx-auto rounded-lg shadow-md border-2 border-gray-300"
                            crossOrigin="anonymous"
                            referrerPolicy="no-referrer"
                            onError={(e) => { 
                                e.target.onerror = null; 
                                e.target.src = `https://placehold.co/566x320/FF0000/FFFFFF?text=L%E1%BB%97I+T%E1%BA%A2I+%E1%BA%A2NH+(B%E1%BA%A3o+m%E1%BA%ADt)`; 
                                showMessage('Lỗi tải ảnh: File media có thể đã bị chặn.', 'error');
                            }}
                        />
                        {question.imagePrompt && <p className="text-sm text-blue-600 mt-2 font-medium">Gợi ý nội dung: {question.imagePrompt}</p>}
                    </div>
                );
            }

            if (question.mediaType === 'audio') {
                return (
                    <div className="w-full p-4 bg-gray-100 rounded-xl mb-4 text-center border-2 border-dashed border-gray-300">
                        <p className="text-blue-600 font-bold mb-2">🔊 Câu hỏi Nghe (Bấm Play)</p>
                        <audio 
                            controls
                            src={question.mediaSource}
                            className="w-full max-w-sm mx-auto my-2"
                            crossOrigin="anonymous"
                            referrerPolicy="no-referrer"
                            onError={() => {
                                showMessage('Lỗi tải Audio: File media có thể đã bị chặn.', 'error');
                            }}
                        >
                            <source src={question.mediaSource} type="audio/mp3" />
                            Trình duyệt của bạn không hỗ trợ phần tử audio.
                        </audio>
                    </div>
                );
            }
            return null;
        }

        // --- Component: ProgressBar.tsx ---
        const ProgressBar = ({ percentage }) => {
            return (
                <div className="w-full h-2 bg-blue-100 rounded-full mt-4 overflow-hidden">
                    <div
                        className="h-full bg-blue-500 transition-all duration-500 ease-in-out"
                        style={{ width: `${percentage}%` }}
                    ></div>
                </div>
            );
        };
        
        // --- Component: MessageBox.tsx ---
        const MessageBox = ({ message, type }) => {
            const [visible, setVisible] = React.useState(false);

            React.useEffect(() => {
                if (message) {
                    setVisible(true);
                    const timer = setTimeout(() => {
                        setVisible(false);
                    }, 2700);
                    return () => clearTimeout(timer);
                } else {
                    setVisible(false);
                }
            }, [message, type]);

            const baseClasses = "fixed top-4 left-1/2 -translate-x-1/2 p-4 rounded-xl shadow-xl text-center font-bold text-lg z-50 transition-all duration-300 transform";
            
            const typeClasses = {
                success: 'bg-green-100 border border-green-500 text-green-800',
                error: 'bg-red-100 border border-red-500 text-red-800',
                info: 'bg-yellow-100 border border-yellow-500 text-yellow-800',
            };

            const visibilityClasses = visible ? 'opacity-100 scale-100' : 'opacity-0 scale-90 pointer-events-none';

            return (
                <div className={`${baseClasses} ${typeClasses[type]} ${visibilityClasses}`}>
                    {message}
                </div>
            );
        };
        
        // --- Component: RationaleBox.tsx ---
        const RationaleBox = ({ question, isCorrect, submittedAnswer }) => {
            const boxClasses = `mt-6 p-4 rounded-xl border transition duration-300 fade-in border-l-4 ${
                isCorrect ? 'bg-green-100 border-green-600' : 'bg-red-100 border-red-600'
            }`;
            
            const submittedAnswerDisplay = () => {
                const isFillIn = question.type === 'fill-in-the-blank' || (question.type === 'multimedia' && !question.options);
                
                if(isCorrect && !isFillIn) return null;
                
                return (
                    <>
                        <strong className="text-gray-700">
                           Bạn đã chọn/Điền:
                        </strong>
                        <span className="text-red-700 font-medium break-words"> {submittedAnswer}</span>
                        <br/>
                    </>
                );
            }

            return (
                <div className={boxClasses}>
                    <p className="font-bold text-lg mb-2 text-blue-700">Giải thích:</p>
                    <div className="text-gray-700 space-y-1">
                        {!isCorrect && submittedAnswerDisplay()}
                        <div>
                            <strong>Đáp án đúng:</strong> 
                            <span className="text-green-800 font-semibold"> {question.correctAnswer}</span> 
                            {question.correctAnswer_vi && <span className="text-green-600 font-medium"> ({question.correctAnswer_vi})</span>}
                        </div>
                        <p className="pt-2">{question.rationale_vi || 'Không có giải thích chi tiết.'}</p>
                    </div>
                </div>
            );
        };

        // --- Component: FillInTheBlankQuestion.tsx ---
        const FillInTheBlankQuestion = ({ question, isAnswered, onSubmit, showMessage, questionIndex }) => {
            const [inputValue, setInputValue] = React.useState('');

            React.useEffect(() => {
                setInputValue('');
            }, [question]);

            const handleSubmitClick = () => {
                const trimmedInput = inputValue.trim();
                if (trimmedInput === '') {
                    showMessage('Vui lòng điền câu trả lời của bạn!', 'info');
                    return;
                }
                const isCorrect = trimmedInput.toLowerCase() === question.correctAnswer.toLowerCase();
                onSubmit(trimmedInput, isCorrect);
            };
            
            const questionTextParts = React.useMemo(() => {
                let text = question.question.replace(/^\d+\.\s*/, '');
                const blankMarkers = ['____', '_ _ _ _', '_ _ _', '_ _'];
                
                for (const marker of blankMarkers) {
                    if (text.includes(marker)) {
                        const parts = text.split(marker);
                        return [parts[0], parts.slice(1).join(marker)];
                    }
                }
                
                return [text, '']; 
            }, [question.question]);
            

            let inputClasses = 'inline-block mx-2 p-2 border-2 rounded-lg text-lg text-center shadow-sm transition duration-200 align-baseline w-48 font-mono';
            if (isAnswered) {
                const isSubmissionCorrect = inputValue.trim().toLowerCase() === question.correctAnswer.toLowerCase();
                inputClasses += isSubmissionCorrect ? ' border-green-500 bg-green-50 font-bold' : ' border-red-500 bg-red-50 font-bold';
            } else {
                inputClasses += ' border-gray-300 focus:border-blue-500';
            }

            const placeholderLength = question.correctAnswer.length > 0 ? question.correctAnswer.length : 4;
            const inputWidthStyle = {
                width: `${Math.max(8, placeholderLength * 1.5)}rem`, 
                maxWidth: '100%',
            };


            return (
                <div className="space-y-4">
                    {question.mediaType && <MediaDisplay question={question} showMessage={showMessage} />}
                    <div className="text-xl sm:text-2xl font-semibold mb-6 leading-relaxed text-center flex justify-center items-center flex-wrap">
                        <span>{questionIndex + 1}. </span>
                        {questionTextParts[0] && <span className="ml-1">{questionTextParts[0]}</span>}
                        <input
                            type="text"
                            value={inputValue}
                            onChange={(e) => setInputValue(e.target.value)}
                            disabled={isAnswered}
                            placeholder={isAnswered ? question.correctAnswer : "Điền từ"}
                            className={inputClasses}
                            style={inputWidthStyle}
                            onKeyPress={(e) => e.key === 'Enter' && !isAnswered && handleSubmitClick()}
                            aria-label="Fill in the blank"
                        />
                        {questionTextParts[1] && <span>{questionTextParts[1]}</span>}
                    </div>
                    <button
                        onClick={handleSubmitClick}
                        disabled={isAnswered}
                        className="w-full py-2 px-4 bg-green-600 text-white font-semibold rounded-lg shadow-md transition duration-300 hover:bg-green-700 mt-4 disabled:bg-gray-400 disabled:cursor-not-allowed active:scale-98"
                    >
                        Kiểm Tra
                    </button>
                </div>
            );
        };
        
        // --- Component: MultipleChoiceQuestion.tsx ---
        const MultipleChoiceQuestion = ({ question, isAnswered, onSubmit, showMessage, questionIndex }) => {
            const [selectedIndex, setSelectedIndex] = React.useState(null);

            React.useEffect(() => {
                setSelectedIndex(null);
            }, [question]);

            const handleSubmitClick = () => {
                if (selectedIndex === null) {
                    showMessage('Vui lòng chọn một đáp án!', 'info');
                    return;
                }
                const selectedOption = question.options[selectedIndex];
                onSubmit(selectedOption.text, selectedOption.isCorrect);
            };

            return (
                <>
                    {question.mediaType && <MediaDisplay question={question} showMessage={showMessage} />}
                    <h3
                        className="text-xl sm:text-2xl font-semibold mb-6 leading-relaxed"
                        dangerouslySetInnerHTML={{ __html: `${questionIndex + 1}. ${question.question.replace(/^\d+\.\s*/, '')}` }}
                    />
                    <div className="space-y-4">
                        <div className="space-y-3">
                            {question.options.map((option, index) => {
                                const isSelected = selectedIndex === index;
                                let labelClasses = "block p-4 border-2 rounded-xl shadow-md text-lg transition duration-200";

                                if (isAnswered) {
                                    labelClasses += " cursor-default";
                                    if (option.isCorrect) {
                                        labelClasses += " bg-green-100 border-green-500 font-bold";
                                    } else if (isSelected) {
                                        labelClasses += " bg-red-100 border-red-500 font-bold";
                                    } else {
                                        labelClasses += " border-gray-200 opacity-60";
                                    }
                                } else {
                                    labelClasses += " cursor-pointer hover:bg-blue-50 hover:border-blue-300";
                                    if(isSelected) {
                                        labelClasses += " bg-blue-100 border-blue-500";
                                    } else {
                                        labelClasses += " border-gray-200";
                                    }
                                }

                                return (
                                    <div key={index} className="relative">
                                        <input
                                            type="radio"
                                            id={`option-${questionIndex}-${index}`}
                                            name={`mc-option-${questionIndex}`}
                                            value={index}
                                            className="hidden"
                                            checked={isSelected}
                                            onChange={() => setSelectedIndex(index)}
                                            disabled={isAnswered}
                                        />
                                        <label htmlFor={`option-${questionIndex}-${index}`} className={labelClasses}>
                                            {option.text}
                                        </label>
                                    </div>
                                );
                            })}
                        </div>
                        <button
                            onClick={handleSubmitClick}
                            disabled={isAnswered}
                            className="w-full py-2 px-4 bg-green-600 text-white font-semibold rounded-lg shadow-md transition duration-300 hover:bg-green-700 mt-4 disabled:bg-gray-400 disabled:cursor-not-allowed active:scale-98"
                        >
                            Kiểm Tra
                        </button>
                    </div>
                </>
            );
        };
        
        // --- Component: RearrangeQuestion.tsx ---
        const WordBlock = ({ word, onClick, isSource, isAnswered }) => {
            const baseClasses = 'word-block px-3 py-2 text-base sm:text-lg font-semibold rounded-lg shadow-sm transition-all duration-150 break-words transform active:scale-95';
            const sourceClasses = isSource ? 'bg-blue-100 text-blue-800 hover:bg-blue-200' : 'bg-gray-100 text-gray-800 border-b-2 border-gray-300';
            const disabledClasses = 'opacity-60 cursor-default shadow-inner';
            const interactiveClasses = 'cursor-pointer';

            return (
                <span
                    onClick={!isAnswered ? onClick : undefined}
                    className={`${baseClasses} ${sourceClasses} ${isAnswered ? disabledClasses : interactiveClasses}`}
                >
                    {word.text}
                </span>
            );
        };

        const RearrangeQuestion = ({ question, isAnswered, onSubmit, showMessage, questionIndex, isCorrect }) => {
            const [sentenceWords, setSentenceWords] = React.useState([]);
            
            const initialSourceWords = React.useMemo(() => {
                return [...question.words]
                    .map((text) => ({ id: crypto.randomUUID(), text })) 
                    .sort(() => Math.random() - 0.5);
            }, [question]);

            const [sourceWords, setSourceWords] = React.useState(initialSourceWords);

            React.useEffect(() => {
                setSourceWords(initialSourceWords);
                setSentenceWords([]);
            }, [initialSourceWords]);

            const handleSelectWord = (word) => {
                setSourceWords(prev => prev.filter(w => w.id !== word.id));
                setSentenceWords(prev => [...prev, word]);
            };

            const handleReturnWord = (word) => {
                setSentenceWords(prev => prev.filter(w => w.id !== word.id));
                // Add back to source, maintaining the original order for a better user experience
                const originalIndex = initialSourceWords.findIndex(sw => sw.text === word.text && !sourceWords.some(s => s.id === sw.id));
                const newSource = [...sourceWords, word];
                newSource.sort((a,b) => {
                    const indexA = initialSourceWords.findIndex(sw => sw.text === a.text);
                    const indexB = initialSourceWords.findIndex(sw => sw.text === b.text);
                    return indexA - indexB;
                });
                setSourceWords(newSource);
            };

            const handleSubmitClick = () => {
                if (sentenceWords.length === 0) {
                    showMessage('Vui lòng sắp xếp các từ!', 'info');
                    return;
                }
                
                const submitted = sentenceWords.map(w => w.text).join(' ').replace(/\s+([.,?!])/g, '$1').trim();
                const correct = question.correctAnswer.replace(/\s+([.,?!])/g, '$1').trim();
                
                const normalize = (str) => str
                    .replace(/[.,?!]/g, '')
                    .replace(/’|'/g, '') 
                    .replace(/\s+/g, ' ')
                    .toLowerCase()
                    .trim();
                
                const isCorrectResult = normalize(submitted) === normalize(correct);
                onSubmit(submitted, isCorrectResult);
            };

            return (
                <>
                    <h3
                        className="text-xl sm:text-2xl font-semibold mb-6 leading-relaxed"
                        dangerouslySetInnerHTML={{ __html: `${questionIndex + 1}. ${question.question.replace(/^\d+\.\s*/, '')}` }}
                    />
                    <div className="space-y-4">
                        <div className={`min-h-[60px] p-3 border-2 rounded-xl shadow-inner flex flex-wrap gap-2 items-center transition duration-300 ${isAnswered ? (isCorrect ? 'border-green-500 bg-green-50' : 'border-red-500 bg-red-50') : 'border-blue-300 bg-blue-50 border-dashed'}`}>
                            {sentenceWords.length === 0 && !isAnswered ? (
                                <span className="text-gray-500 italic text-sm">Chạm vào các từ bên dưới để xây dựng câu...</span>
                            ) : (
                                sentenceWords.map(word => (
                                    <WordBlock key={word.id} word={word} onClick={() => handleReturnWord(word)} isSource={false} isAnswered={isAnswered} />
                                ))
                            )}
                        </div>
                        
                        <div className="min-h-[100px] p-4 bg-gray-100 rounded-xl shadow-md flex flex-wrap gap-2 items-center border border-gray-200">
                            {sourceWords.map(word => (
                                <WordBlock key={word.id} word={word} onClick={() => handleSelectWord(word)} isSource={true} isAnswered={isAnswered} />
                            ))}
                        </div>
                        <button
                            onClick={handleSubmitClick}
                            disabled={isAnswered}
                            className="w-full py-2 px-4 bg-green-600 text-white font-semibold rounded-lg shadow-md transition duration-300 hover:bg-green-700 mt-4 disabled:bg-gray-400 disabled:cursor-not-allowed active:scale-98"
                        >
                            Kiểm Tra
                        </button>
                    </div>
                </>
            );
        };
        
        // --- Component: StartScreen.tsx ---
        const StartScreen = ({ onStart }) => {
            const [name, setName] = React.useState('');

            const handleStart = () => {
                if (name.trim()) {
                    onStart(name.trim());
                }
            };

            const isButtonDisabled = name.trim() === '';

            return (
                <div className="fade-in text-center p-4">
                    <header className="mb-8">
                        <h1 className="text-3xl sm:text-4xl font-extrabold text-blue-600 mb-2">Bài Thi Thử IOE Lớp 4 (Đề số 3.1)</h1>
                        <p className="text-lg text-gray-500">Bộ đề ôn luyện ({questions.length} câu)</p>
                    </header>
                    <div className="max-w-md mx-auto bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                        <h2 className="text-2xl font-semibold mb-4 text-gray-700">Chào mừng bạn!</h2>
                        <p className="text-gray-600 mb-6">Mỗi câu trả lời đúng được cộng 10 điểm.</p>
                        <div className="space-y-4">
                            <label htmlFor="player-name" className="block text-sm font-medium text-gray-700 text-left">Nhập tên của bạn để bắt đầu:</label>
                            <input
                                type="text"
                                id="player-name"
                                placeholder="Tên người chơi"
                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-lg shadow-sm transition duration-150"
                                maxLength={50}
                                value={name}
                                onChange={(e) => setName(e.target.value)}
                                onKeyPress={(e) => e.key === 'Enter' && !isButtonDisabled && handleStart()}
                            />
                            <button
                                onClick={handleStart}
                                disabled={isButtonDisabled}
                                className="w-full py-3 px-4 bg-blue-500 text-white font-bold rounded-xl shadow-lg transition duration-300 hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-xl active:scale-98"
                            >
                                Bắt Đầu
                            </button>
                        </div>
                    </div>
                </div>
            );
        };
        
        // --- Component: EndScreen.tsx ---
        const EndScreen = ({ playerName, score, onRestart, onReview, incorrectAnswers }) => {
            const maxScore = questions.length * 10;
            const percentage = maxScore > 0 ? (score / maxScore) * 100 : 0;

            let message = "Cố gắng hơn vào lần sau nhé!";
            if (percentage === 100) {
                message = "Tuyệt vời! Bạn đã trả lời đúng tất cả các câu hỏi!";
            } else if (percentage >= 80) {
                message = "Kết quả rất tốt! Chỉ cần cố thêm một chút nữa.";
            } else if (percentage >= 50) {
                message = "Khá tốt! Hãy xem lại các câu sai để cải thiện nhé.";
            }

            return (
                <div className="text-center fade-in p-4">
                    <h2 className="text-3xl font-bold mb-2 text-green-600">🎉 Hoàn Thành Bài Thi! 🎉</h2>
                    <p className="text-lg text-gray-600 mb-6">{message}</p>
                    
                    <div className="bg-white p-8 rounded-xl shadow-lg inline-block border border-gray-100 my-4">
                        <p className="text-xl font-semibold mb-2 text-gray-700">
                           Điểm số của <span className="font-extrabold text-blue-600">{playerName}</span>:
                        </p>
                        <p className={`text-6xl font-black ${score === maxScore ? 'text-yellow-500' : 'text-blue-700'}`}>
                            {score} / {maxScore}
                        </p>
                    </div>

                    <div className="mt-8 flex flex-col sm:flex-row justify-center gap-4">
                        <button
                            onClick={onRestart}
                            className="py-3 px-6 bg-blue-500 text-white font-bold rounded-xl shadow-lg transition duration-300 hover:bg-blue-600 text-lg active:scale-98"
                        >
                            Làm lại bài thi
                        </button>
                        {incorrectAnswers.length > 0 && (
                             <button
                                onClick={onReview}
                                className="py-3 px-6 bg-orange-500 text-white font-bold rounded-xl shadow-lg transition duration-300 hover:bg-orange-600 text-lg active:scale-98"
                            >
                                Xem lại {incorrectAnswers.length} câu sai
                            </button>
                        )}
                    </div>
                </div>
            );
        };

        // --- NEW Component: ReviewScreen.tsx ---
        const ReviewScreen = ({ incorrectAnswers, onReturn }) => {
            return (
                <div className="fade-in">
                     <header className="mb-8">
                        <div className="flex justify-between items-center">
                            <h2 className="text-2xl sm:text-3xl font-extrabold text-blue-600">Xem lại các câu đã làm sai</h2>
                             <button
                                onClick={onReturn}
                                className="py-2 px-4 bg-gray-200 text-gray-800 font-bold rounded-xl shadow-md transition duration-300 hover:bg-gray-300 text-base active:scale-98"
                            >
                                « Quay lại
                            </button>
                        </div>
                    </header>
                    <div className="space-y-8">
                        {incorrectAnswers.map((item, index) => (
                             <div key={index} className="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                                {item.question.type === 'mc' && <MultipleChoiceQuestion question={item.question} isAnswered={true} onSubmit={()=>{}} showMessage={()=>{}} questionIndex={item.question.originalIndex} />}
                                {item.question.type === 'fill-in-the-blank' && <FillInTheBlankQuestion question={item.question} isAnswered={true} onSubmit={()=>{}} showMessage={()=>{}} questionIndex={item.question.originalIndex}/>}
                                {item.question.type === 'rearrange' && <RearrangeQuestion question={item.question} isAnswered={true} onSubmit={()=>{}} showMessage={()=>{}} questionIndex={item.question.originalIndex} isCorrect={false}/>}
                                {item.question.type === 'multimedia' && (item.question.options ? 
                                    <MultipleChoiceQuestion question={item.question} isAnswered={true} onSubmit={()=>{}} showMessage={()=>{}} questionIndex={item.question.originalIndex} /> :
                                    <FillInTheBlankQuestion question={item.question} isAnswered={true} onSubmit={()=>{}} showMessage={()=>{}} questionIndex={item.question.originalIndex} />
                                )}
                                <RationaleBox question={item.question} isCorrect={false} submittedAnswer={item.submittedAnswer} />
                            </div>
                        ))}
                    </div>
                </div>
            );
        }
        
        // --- Component: QuizScreen.tsx ---
        const QuizScreen = ({ playerName, onEnd }) => {
            const [shuffledQuestions, setShuffledQuestions] = React.useState([]);
            const [currentQuestionIndex, setCurrentQuestionIndex] = React.useState(0);
            const [score, setScore] = React.useState(0);
            const [isAnswered, setIsAnswered] = React.useState(false);
            const [scoredThisQuestion, setScoredThisQuestion] = React.useState(false);
            const [isCorrect, setIsCorrect] = React.useState(false);
            const [submittedAnswer, setSubmittedAnswer] = React.useState('');
            const [isHintVisible, setIsHintVisible] = React.useState(false);
            const [message, setMessage] = React.useState(null);
            const [incorrectQuestions, setIncorrectQuestions] = React.useState([]);

            React.useEffect(() => {
                const array = [...questions].map((q, index) => ({...q, originalIndex: index}));
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                setShuffledQuestions(array);
            }, []);

            const currentQuestion = shuffledQuestions[currentQuestionIndex];

            React.useEffect(() => {
                setIsAnswered(false);
                setScoredThisQuestion(false);
                setIsCorrect(false);
                setSubmittedAnswer('');
                setIsHintVisible(false);
                setMessage(null);
            }, [currentQuestionIndex]);
            
            const showMessage = (text, type) => {
                setMessage({ text, type });
            };

            const handleSubmit = React.useCallback((answer, isAnswerCorrect) => {
                if (isAnswered) return;
                
                setIsAnswered(true);
                setSubmittedAnswer(answer);
                setIsCorrect(isAnswerCorrect);

                if (isAnswerCorrect) {
                    if (!scoredThisQuestion) {
                        setScore(prev => prev + 10);
                        setScoredThisQuestion(true);
                    }
                    showMessage('CHÍNH XÁC!', 'success');
                } else {
                    showMessage('SAI RỒI!', 'error');
                    setIncorrectQuestions(prev => [...prev, { question: currentQuestion, submittedAnswer: answer }]);
                }
            }, [isAnswered, scoredThisQuestion, currentQuestion]);

            const handleNext = () => {
                if (currentQuestionIndex < shuffledQuestions.length - 1) {
                    setCurrentQuestionIndex(prev => prev + 1);
                } else {
                    onEnd(score, incorrectQuestions);
                }
            };

            if (shuffledQuestions.length === 0 || !currentQuestion) {
                return <div className="text-center p-8">Đang tải câu hỏi...</div>;
            }

            const progressPercentage = ((currentQuestionIndex + 1) / questions.length) * 100;
            
            const renderQuestionComponent = () => {
                const commonProps = {
                    question: currentQuestion,
                    isAnswered,
                    onSubmit: handleSubmit,
                    showMessage,
                    questionIndex: currentQuestion.originalIndex,
                    isCorrect: isCorrect, 
                };

                // Smart routing based on question type and properties
                if (currentQuestion.type === 'rearrange') {
                    return <RearrangeQuestion {...commonProps} />;
                }
                if (currentQuestion.type === 'mc' || (currentQuestion.type === 'multimedia' && currentQuestion.options)) {
                    return <MultipleChoiceQuestion {...commonProps} />;
                }
                if (currentQuestion.type === 'fill-in-the-blank' || (currentQuestion.type === 'multimedia' && !currentQuestion.options)) {
                    return <FillInTheBlankQuestion {...commonProps} />;
                }

                return <div className="text-red-500">Lỗi: Loại câu hỏi không xác định.</div>;
            };

            return (
                <div className="fade-in">
                    {message && <MessageBox message={message.text} type={message.type} />}
                    <header className="text-center mb-8">
                        <h1 className="text-3xl sm:text-4xl font-extrabold text-blue-600 mb-2">Bài Thi Thử IOE Lớp 4 (Đề số 3.1)</h1>
                        <p className="text-lg text-gray-500">Bộ đề ôn luyện ({questions.length} câu)</p>
                        <ProgressBar percentage={progressPercentage} />
                    </header>

                    <div className="flex justify-between items-center mb-6 py-2 px-4 bg-blue-50 rounded-xl shadow-inner border border-blue-100">
                        <p className="text-sm sm:text-base font-medium text-blue-800">Người chơi: <span className="font-bold">{playerName}</span></p>
                        <p className="text-sm sm:text-base font-medium text-blue-800">Điểm: <span className="text-xl font-extrabold text-red-600">{score}</span></p>
                        <p className="text-sm sm:text-base font-medium text-blue-800">Câu hỏi: <span className="font-bold">{currentQuestionIndex + 1}/{questions.length}</span></p>
                    </div>

                    <div className="mb-8">
                        {renderQuestionComponent()}
                    </div>

                    {isAnswered && <RationaleBox question={currentQuestion} isCorrect={isCorrect} submittedAnswer={submittedAnswer} />}

                    <div className="mt-8 border-t pt-6 flex justify-between items-center flex-wrap gap-4">
                        <div className="relative">
                            <button
                                className="bg-yellow-500 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 hover:bg-yellow-600 active:scale-95"
                                onMouseEnter={() => setIsHintVisible(true)}
                                onMouseLeave={() => setIsHintVisible(false)}
                                onTouchStart={() => setIsHintVisible(true)}
                                onTouchEnd={() => setIsHintVisible(false)}
                            >
                                Gợi ý
                            </button>
                            {isHintVisible && (
                                <div id="hint-box" className="absolute bottom-full mb-2 w-max max-w-[80vw] sm:max-w-sm p-3 bg-yellow-100 border-l-4 border-yellow-500 rounded-xl shadow-lg">
                                    <p className="font-semibold text-yellow-800">Gợi ý:</p>
                                    <p className="text-yellow-700">{currentQuestion.hint_vi || 'Không có gợi ý.'}</p>
                                </div>
                            )}
                        </div>
                        
                        <button onClick={handleNext} disabled={!isAnswered} className="flex-grow py-3 px-4 bg-blue-500 text-white font-bold rounded-xl shadow-xl transition duration-300 hover:bg-blue-600 disabled:bg-gray-400 disabled:cursor-not-allowed active:scale-98">
                            {currentQuestionIndex === shuffledQuestions.length - 1 ? 'Hoàn thành' : 'Câu tiếp theo »'}
                        </button>
                    </div>
                </div>
            );
        };
        
        // --- Component: App.tsx ---
        const App = () => {
            const [gameState, setGameState] = React.useState('start');
            const [playerName, setPlayerName] = React.useState('');
            const [score, setScore] = React.useState(0);
            const [incorrectAnswers, setIncorrectAnswers] = React.useState([]);


            const handleStartQuiz = React.useCallback((name) => {
                setPlayerName(name);
                setScore(0);
                setIncorrectAnswers([]);
                setGameState('quiz');
            }, []);

            const handleEndQuiz = React.useCallback((finalScore, mistakes) => {
                setScore(finalScore);
                setIncorrectAnswers(mistakes);
                setGameState('end');
            }, []);
            
            const handleRestartQuiz = React.useCallback(() => {
                setGameState('start');
            }, []);

            const handleReview = () => {
                setGameState('review');
            };

            const handleReturnToEnd = () => {
                setGameState('end');
            }

            const renderContent = () => {
                switch (gameState) {
                    case 'start':
                        return <StartScreen onStart={handleStartQuiz} />;
                    case 'quiz':
                        return <QuizScreen playerName={playerName} onEnd={handleEndQuiz} />;
                    case 'end':
                        return <EndScreen playerName={playerName} score={score} onRestart={handleRestartQuiz} onReview={handleReview} incorrectAnswers={incorrectAnswers} />;
                    case 'review':
                        return <ReviewScreen incorrectAnswers={incorrectAnswers} onReturn={handleReturnToEnd} />;
                    default:
                        return <StartScreen onStart={handleStartQuiz} />;
                }
            };

            return (
                <div className="p-4 sm:p-8 flex justify-center items-start min-h-screen">
                    <div className="w-full max-w-3xl bg-white rounded-xl shadow-2xl p-6 sm:p-8 md:p-10 border border-gray-100 min-h-[80vh]">
                        {renderContent()}
                    </div>
                </div>
            );
        };
        
        // --- Entry point from index.tsx ---
        const rootElement = document.getElementById('root');
        if (!rootElement) {
            throw new Error("Could not find root element to mount to");
        }

        const root = ReactDOM.createRoot(rootElement);
        root.render(
            <React.StrictMode>
                <App />
            </React.StrictMode>
        );

    </script>
</body>
</html>
